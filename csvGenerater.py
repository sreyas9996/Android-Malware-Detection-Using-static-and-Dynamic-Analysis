#!/usr/bin/python
from sys import argv
from androguard.core.bytecodes import apk
from androguard.core.bytecodes import dvm
import csv

if __name__=="__main__":
	i=1
	j=int(argv[2])
	fieldnames=["APK Name","android.permission.ACCESS_CHECKIN_PROPERTIES" , "android.permission.ACCESS_COARSE_LOCATION" , "android.permission.ACCESS_FINE_LOCATION" , "android.permission.ACCESS_LOCATION_EXTRA_COMMANDS" , "android.permission.ACCESS_NETWORK_STATE" , "android.permission.ACCESS_NOTIFICATION_POLICY" , "android.permission.ACCESS_WIFI_STATE" , "android.permission.ACCOUNT_MANAGER" , "android.permission.ADD_VOICEMAIL" , "android.permission.ALLOCATE_AGGRESSIVE" , "android.permission.ANSWER_PHONE_CALLS" , "android.permission.BATTERY_STATS" , "android.permission.BIND_ACCESSIBILITY_SERVICE" , "android.permission.BIND_APPWIDGET" , "android.permission.BIND_AUTOFILL" , "android.permission.BIND_AUTO_FILL" , "android.permission.BIND_CARRIER_MESSAGING_SERVICE" , "android.permission.BIND_CARRIER_SERVICES" , "android.permission.BIND_CHOOSER_TARGET_SERVICE" , "android.permission.BIND_CONDITION_PROVIDER_SERVICE" , "android.permission.BIND_DEVICE_ADMIN" , "android.permission.BIND_DREAM_SERVICE" , "android.permission.BIND_INCALL_SERVICE" , "android.permission.BIND_INPUT_METHOD" , "android.permission.BIND_MIDI_DEVICE_SERVICE" , "android.permission.BIND_NFC_SERVICE" , "android.permission.BIND_NOTIFICATION_LISTENER_SERVICE" , "android.permission.BIND_PRINT_SERVICE" , "android.permission.BIND_QUICK_SETTINGS_TILE" , "android.permission.BIND_REMOTEVIEWS" , "android.permission.BIND_SCREENING_SERVICE" , "android.permission.BIND_TELECOM_CONNECTION_SERVICE" , "android.permission.BIND_TEXT_SERVICE" , "android.permission.BIND_TV_INPUT" , "android.permission.BIND_VISUAL_VOICEMAIL_SERVICE" , "android.permission.BIND_VOICE_INTERACTION" , "android.permission.BIND_VPN_SERVICE" , "android.permission.BIND_VR_LISTENER_SERVICE" , "android.permission.BIND_WALLPAPER" , "android.permission.BLUETOOTH" , "android.permission.BLUETOOTH_ADMIN" , "android.permission.BLUETOOTH_PRIVILEGED" , "android.permission.BODY_SENSORS" , "android.permission.BROADCAST_PACKAGE_REMOVED" , "android.permission.BROADCAST_SMS" , "android.permission.BROADCAST_STICKY" , "android.permission.BROADCAST_WAP_PUSH" , "android.permission.CALL_PHONE" , "android.permission.CALL_PRIVILEGED" , "android.permission.CAMERA" , "android.permission.CAPTURE_AUDIO_OUTPUT" , "android.permission.CAPTURE_SECURE_VIDEO_OUTPUT" , "android.permission.CAPTURE_VIDEO_OUTPUT" , "android.permission.CHANGE_COMPONENT_ENABLED_STATE" , "android.permission.CHANGE_CONFIGURATION" , "android.permission.CHANGE_NETWORK_STATE" , "android.permission.CHANGE_WIFI_MULTICAST_STATE" , "android.permission.CHANGE_WIFI_STATE" , "android.permission.CLEAR_APP_CACHE" , "android.permission.CONTROL_LOCATION_UPDATES" , "android.permission.DELETE_CACHE_FILES" , "android.permission.DELETE_PACKAGES" , "android.permission.DIAGNOSTIC" , "android.permission.DISABLE_KEYGUARD" , "android.permission.DUMP" , "android.permission.EXPAND_STATUS_BAR" , "android.permission.FACTORY_TEST" , "android.permission.GET_ACCOUNTS" , "android.permission.GET_ACCOUNTS_PRIVILEGED" , "android.permission.GET_PACKAGE_SIZE" , "android.permission.GET_TASKS" , "android.permission.GLOBAL_SEARCH" , "android.permission.INSTALL_LOCATION_PROVIDER" , "android.permission.INSTALL_PACKAGES" , "android.permission.INSTALL_SHORTCUT" , "android.permission.INSTANT_APP_FOREGROUND_SERVICE" , "android.permission.INTERNET" , "android.permission.KILL_BACKGROUND_PROCESSES" , "android.permission.LOCATION_HARDWARE" , "android.permission.MANAGE_DOCUMENTS" , "android.permission.MANAGE_OWN_CALLS" , "android.permission.MASTER_CLEAR" , "android.permission.MEDIA_CONTENT_CONTROL" , "android.permission.MODIFY_AUDIO_SETTINGS" , "android.permission.MODIFY_PHONE_STATE" , "android.permission.MOUNT_FORMAT_FILESYSTEMS" , "android.permission.MOUNT_UNMOUNT_FILESYSTEMS" , "android.permission.NFC" , "android.permission.PACKAGE_USAGE_STATS" , "android.permission.PERSISTENT_ACTIVITY" , "android.permission.PROCESS_OUTGOING_CALLS" , "android.permission.READ_CALENDAR" , "android.permission.READ_CALL_LOG" , "android.permission.READ_CONTACTS" , "android.permission.READ_EXTERNAL_STORAGE" , "android.permission.READ_FRAME_BUFFER" , "android.permission.READ_INPUT_STATE" , "android.permission.READ_LOGS" , "android.permission.READ_PHONE_NUMBERS" , "android.permission.READ_PHONE_STATE" , "android.permission.READ_SMS" , "android.permission.READ_SYNC_SETTINGS" , "android.permission.READ_SYNC_STATS" , "android.permission.READ_VOICEMAIL" , "android.permission.REBOOT" , "android.permission.RECEIVE_BOOT_COMPLETED" , "android.permission.RECEIVE_MMS" , "android.permission.RECEIVE_SMS" , "android.permission.RECEIVE_WAP_PUSH" , "android.permission.RECORD_AUDIO" , "android.permission.REORDER_TASKS" , "android.permission.REQUEST_DELETE_PACKAGES" , "android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" , "android.permission.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS." , "android.permission.REQUEST_INSTALL_PACKAGES" , "android.permission.RESTART_PACKAGES" , "android.permission.RESTRICTED_VR_ACCESS" , "android.permission.SEND_RESPOND_VIA_MESSAGE" , "android.permission.SEND_SMS" , "android.permission.SET_ALARM" , "android.permission.SET_ALWAYS_FINISH" , "android.permission.SET_ANIMATION_SCALE" , "android.permission.SET_DEBUG_APP" , "android.permission.SET_PREFERRED_APPLICATIONS" , "android.permission.ET_PROCESS_LIMIT" , "android.permission.SET_TIME" , "android.permission.SET_TIME_ZONE" , "android.permission.SET_WALLPAPER" , "android.permission.SET_WALLPAPER_HINTS" , "android.permission.SIGNAL_PERSISTENT_PROCESSES" , "android.permission.STATUS_BAR" , "android.permission.SYSTEM_ALERT_WINDOW" , "android.permission.TRANSMIT_IR" , "android.permission.UNINSTALL_SHORTCUT" , "android.permission.UPDATE_DEVICE_STATS" , "android.permission.USE_DATA_IN_BACKGROUND" , "android.permission.USE_FINGERPRINT" , "android.permission.USE_SIP" , "android.permission.VIBRATE" , "android.permission.WAKE_LOCK" , "android.permission.WRITE_APN_SETTINGS" , "android.permission.WRITE_CALENDAR" , "android.permission.WRITE_CALL_LOG" , "android.permission.WRITE_CONTACTS" , "android.permission.WRITE_EXTERNAL_STORAGE" , "android.permission.WRITE_GSERVICES" , "android.permission.WRITE_SECURE_SETTINGS" , "android.permission.WRITE_SETTINGS" , "android.permission.WRITE_SYNC_SETTINGS" , "android.permission.WRITE_VOICEMAIL"]
	dic={"APK Name": "","android.permission.ACCESS_CHECKIN_PROPERTIES": 0 , "android.permission.ACCESS_COARSE_LOCATION": 0 , "android.permission.ACCESS_FINE_LOCATION": 0 , "android.permission.ACCESS_LOCATION_EXTRA_COMMANDS": 0 , "android.permission.ACCESS_NETWORK_STATE": 0 , "android.permission.ACCESS_NOTIFICATION_POLICY": 0 , "android.permission.ACCESS_WIFI_STATE": 0 , "android.permission.ACCOUNT_MANAGER": 0 , "android.permission.ADD_VOICEMAIL": 0 , "android.permission.ALLOCATE_AGGRESSIVE": 0 , "android.permission.ANSWER_PHONE_CALLS": 0 , "android.permission.BATTERY_STATS": 0 , "android.permission.BIND_ACCESSIBILITY_SERVICE": 0 , "android.permission.BIND_APPWIDGET": 0 , "android.permission.BIND_AUTOFILL": 0 , "android.permission.BIND_AUTO_FILL": 0 , "android.permission.BIND_CARRIER_MESSAGING_SERVICE": 0 , "android.permission.BIND_CARRIER_SERVICES": 0 , "android.permission.BIND_CHOOSER_TARGET_SERVICE": 0 , "android.permission.BIND_CONDITION_PROVIDER_SERVICE": 0 , "android.permission.BIND_DEVICE_ADMIN": 0 , "android.permission.BIND_DREAM_SERVICE": 0 , "android.permission.BIND_INCALL_SERVICE": 0 , "android.permission.BIND_INPUT_METHOD": 0 , "android.permission.BIND_MIDI_DEVICE_SERVICE": 0 , "android.permission.BIND_NFC_SERVICE": 0 , "android.permission.BIND_NOTIFICATION_LISTENER_SERVICE": 0 , "android.permission.BIND_PRINT_SERVICE": 0 , "android.permission.BIND_QUICK_SETTINGS_TILE": 0 , "android.permission.BIND_REMOTEVIEWS": 0 , "android.permission.BIND_SCREENING_SERVICE": 0 , "android.permission.BIND_TELECOM_CONNECTION_SERVICE": 0 , "android.permission.BIND_TEXT_SERVICE": 0 , "android.permission.BIND_TV_INPUT": 0 , "android.permission.BIND_VISUAL_VOICEMAIL_SERVICE": 0 , "android.permission.BIND_VOICE_INTERACTION": 0 , "android.permission.BIND_VPN_SERVICE": 0 , "android.permission.BIND_VR_LISTENER_SERVICE": 0 , "android.permission.BIND_WALLPAPER": 0 , "android.permission.BLUETOOTH": 0 , "android.permission.BLUETOOTH_ADMIN": 0 , "android.permission.BLUETOOTH_PRIVILEGED": 0 , "android.permission.BODY_SENSORS": 0 , "android.permission.BROADCAST_PACKAGE_REMOVED": 0 , "android.permission.BROADCAST_SMS": 0 , "android.permission.BROADCAST_STICKY": 0 , "android.permission.BROADCAST_WAP_PUSH": 0 , "android.permission.CALL_PHONE": 0 , "android.permission.CALL_PRIVILEGED": 0 , "android.permission.CAMERA": 0 , "android.permission.CAPTURE_AUDIO_OUTPUT": 0 , "android.permission.CAPTURE_SECURE_VIDEO_OUTPUT": 0 , "android.permission.CAPTURE_VIDEO_OUTPUT": 0 , "android.permission.CHANGE_COMPONENT_ENABLED_STATE": 0 , "android.permission.CHANGE_CONFIGURATION": 0 , "android.permission.CHANGE_NETWORK_STATE": 0 , "android.permission.CHANGE_WIFI_MULTICAST_STATE": 0 , "android.permission.CHANGE_WIFI_STATE": 0 , "android.permission.CLEAR_APP_CACHE": 0 , "android.permission.CONTROL_LOCATION_UPDATES": 0 , "android.permission.DELETE_CACHE_FILES": 0 , "android.permission.DELETE_PACKAGES": 0 , "android.permission.DIAGNOSTIC": 0 , "android.permission.DISABLE_KEYGUARD": 0 , "android.permission.DUMP": 0 , "android.permission.EXPAND_STATUS_BAR": 0 , "android.permission.FACTORY_TEST": 0 , "android.permission.GET_ACCOUNTS": 0 , "android.permission.GET_ACCOUNTS_PRIVILEGED": 0 , "android.permission.GET_PACKAGE_SIZE": 0 , "android.permission.GET_TASKS": 0 , "android.permission.GLOBAL_SEARCH": 0 , "android.permission.INSTALL_LOCATION_PROVIDER": 0 , "android.permission.INSTALL_PACKAGES": 0 , "android.permission.INSTALL_SHORTCUT": 0 , "android.permission.INSTANT_APP_FOREGROUND_SERVICE": 0 , "android.permission.INTERNET": 0 , "android.permission.KILL_BACKGROUND_PROCESSES": 0 , "android.permission.LOCATION_HARDWARE": 0 , "android.permission.MANAGE_DOCUMENTS": 0 , "android.permission.MANAGE_OWN_CALLS": 0 , "android.permission.MASTER_CLEAR": 0 , "android.permission.MEDIA_CONTENT_CONTROL": 0 , "android.permission.MODIFY_AUDIO_SETTINGS": 0 , "android.permission.MODIFY_PHONE_STATE": 0 , "android.permission.MOUNT_FORMAT_FILESYSTEMS": 0 , "android.permission.MOUNT_UNMOUNT_FILESYSTEMS": 0 , "android.permission.NFC": 0 , "android.permission.PACKAGE_USAGE_STATS": 0 , "android.permission.PERSISTENT_ACTIVITY": 0 , "android.permission.PROCESS_OUTGOING_CALLS": 0 , "android.permission.READ_CALENDAR": 0 , "android.permission.READ_CALL_LOG": 0 , "android.permission.READ_CONTACTS": 0 , "android.permission.READ_EXTERNAL_STORAGE": 0 , "android.permission.READ_FRAME_BUFFER": 0 , "android.permission.READ_INPUT_STATE": 0 , "android.permission.READ_LOGS": 0 , "android.permission.READ_PHONE_NUMBERS": 0 , "android.permission.READ_PHONE_STATE": 0 , "android.permission.READ_SMS": 0 , "android.permission.READ_SYNC_SETTINGS": 0 , "android.permission.READ_SYNC_STATS": 0 , "android.permission.READ_VOICEMAIL": 0 , "android.permission.REBOOT": 0 , "android.permission.RECEIVE_BOOT_COMPLETED": 0 , "android.permission.RECEIVE_MMS": 0 , "android.permission.RECEIVE_SMS": 0 , "android.permission.RECEIVE_WAP_PUSH": 0 , "android.permission.RECORD_AUDIO": 0 , "android.permission.REORDER_TASKS": 0 , "android.permission.REQUEST_DELETE_PACKAGES": 0 , "android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS": 0 , "android.permission.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS.": 0 , "android.permission.REQUEST_INSTALL_PACKAGES": 0 , "android.permission.RESTART_PACKAGES": 0 , "android.permission.RESTRICTED_VR_ACCESS": 0 , "android.permission.SEND_RESPOND_VIA_MESSAGE": 0 , "android.permission.SEND_SMS": 0 , "android.permission.SET_ALARM": 0 , "android.permission.SET_ALWAYS_FINISH": 0 , "android.permission.SET_ANIMATION_SCALE": 0 , "android.permission.SET_DEBUG_APP": 0 , "android.permission.SET_PREFERRED_APPLICATIONS": 0 , "android.permission.ET_PROCESS_LIMIT": 0 , "android.permission.SET_TIME": 0 , "android.permission.SET_TIME_ZONE": 0 , "android.permission.SET_WALLPAPER": 0 , "android.permission.SET_WALLPAPER_HINTS": 0 , "android.permission.SIGNAL_PERSISTENT_PROCESSES": 0 , "android.permission.STATUS_BAR": 0 , "android.permission.SYSTEM_ALERT_WINDOW": 0 , "android.permission.TRANSMIT_IR": 0 , "android.permission.UNINSTALL_SHORTCUT": 0 , "android.permission.UPDATE_DEVICE_STATS": 0 , "android.permission.USE_DATA_IN_BACKGROUND": 0 , "android.permission.USE_FINGERPRINT": 0 , "android.permission.USE_SIP": 0 , "android.permission.VIBRATE": 0 , "android.permission.WAKE_LOCK": 0 , "android.permission.WRITE_APN_SETTINGS": 0 , "android.permission.WRITE_CALENDAR": 0 , "android.permission.WRITE_CALL_LOG": 0 , "android.permission.WRITE_CONTACTS": 0 , "android.permission.WRITE_EXTERNAL_STORAGE": 0 , "android.permission.WRITE_GSERVICES": 0 , "android.permission.WRITE_SECURE_SETTINGS": 0 , "android.permission.WRITE_SETTINGS": 0 , "android.permission.WRITE_SYNC_SETTINGS": 0 , "android.permission.WRITE_VOICEMAIL": 0}
	with open("test.csv","w") as res:
		writer=csv.DictWriter(res,fieldnames=fieldnames)
		writer.writeheader()
	res.close()
	for i in range(1,j+1):
		with open("test.csv","a") as res:
			try:
				a = apk.APK(argv[1]+"/apk"+str(i)+".apk")
				data=list(set(a.get_permissions()))
				data.sort()
				dic1=dict(dic)
				dic1["APK Name"]="apk"+str(i)+".apk"
				for key,value in dic1.items():
					if key in data:
						dic1[key]=1
				writer=csv.DictWriter(res,fieldnames=fieldnames)
				writer.writerow(dic1)
			except Exception:
				continue
		res.close()
	
